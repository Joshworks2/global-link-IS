<?php
session_start();
include __DIR__ . "/config.php";

// check if admin is logged in
if (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'admin') {
    header("Location: login.php");
    exit;
}

// fetch all data
$users = $conn->query("SELECT * FROM users ORDER BY created_at DESC");
$employers = $conn->query("SELECT e.*, u.full_name, u.email FROM employers e JOIN users u ON e.user_id = u.id");
$jobseekers = $conn->query("SELECT j.*, u.full_name, u.email FROM job_seekers j JOIN users u ON j.user_id = u.id");
$applications = $conn->query("SELECT a.*, u.full_name, j.title 
                              FROM applications a 
                              JOIN users u ON a.user_id = u.id
                              JOIN job_posts j ON a.job_id = j.id");
?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
  <h2 class="mb-4">üåç GlobalLink Admin Dashboard</h2>
  
  <ul class="nav nav-tabs" id="adminTabs" role="tablist">
    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#users">Users</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#employers">Employers</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#jobseekers">Job Seekers</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#applications">Applications</a></li>
  </ul>

  <div class="tab-content mt-3">
    <!-- Users Tab -->
    <div class="tab-pane fade show active" id="users">
      <h4>All Users</h4>
      <table class="table table-striped">
        <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Created</th></tr></thead>
        <tbody>
          <?php while($u = $users->fetch_assoc()): ?>
            <tr>
              <td><?= $u['id'] ?></td>
              <td><?= $u['full_name'] ?></td>
              <td><?= $u['email'] ?></td>
              <td><?= $u['role'] ?></td>
              <td><?= $u['created_at'] ?></td>
            </tr>
          <?php endwhile; ?>
        </tbody>
      </table>
    </div>

    <!-- Employers Tab -->
    <div class="tab-pane fade" id="employers">
      <h4>Employers</h4>
      <table class="table table-striped">
        <thead><tr><th>ID</th><th>Company</th><th>Industry</th><th>Email</th><th>Logo</th></tr></thead>
        <tbody>
          <?php while($e = $employers->fetch_assoc()): ?>
            <tr>
              <td><?= $e['id'] ?></td>
              <td><?= $e['company_name'] ?></td>
              <td><?= $e['industry'] ?></td>
              <td><?= $e['email'] ?></td>
              <td><?= $e['logo'] ? '<img src="uploads/'.$e['logo'].'" width="40">' : 'N/A' ?></td>
            </tr>
          <?php endwhile; ?>
        </tbody>
      </table>
    </div>

    <!-- Job Seekers Tab -->
    <div class="tab-pane fade" id="jobseekers">
      <h4>Job Seekers</h4>
      <table class="table table-striped">
        <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Skills</th><th>Education</th></tr></thead>
        <tbody>
          <?php while($j = $jobseekers->fetch_assoc()): ?>
            <tr>
              <td><?= $j['id'] ?></td>
              <td><?= $j['full_name'] ?></td>
              <td><?= $j['email'] ?></td>
              <td><?= $j['skills'] ?></td>
              <td><?= $j['education'] ?></td>
            </tr>
          <?php endwhile; ?>
        </tbody>
      </table>
    </div>

    <!-- Applications Tab -->
    <div class="tab-pane fade" id="applications">
      <h4>Applications</h4>
      <table class="table table-striped">
        <thead><tr><th>ID</th><th>User</th><th>Job</th><th>Status</th><th>Applied At</th></tr></thead>
        <tbody>
          <?php while($a = $applications->fetch_assoc()): ?>
            <tr>
              <td><?= $a['id'] ?></td>
              <td><?= $a['full_name'] ?></td>
              <td><?= $a['title'] ?></td>
              <td><?= $a['status'] ?></td>
              <td><?= $a['applied_at'] ?></td>
            </tr>
          <?php endwhile; ?>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
